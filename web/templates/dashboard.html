{% extends "base.html" %}

{% block title %}ä»ªè¡¨ç›˜ - å¾®ä¿¡æœºå™¨äºº{% endblock %}

{% block extra_css %}
<style>
    .status-badge {
        display: inline-block;
        padding: 6px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .status-running {
        background: linear-gradient(90deg, #00b894, #00cec9);
        color: #fff;
    }

    .status-paused {
        background: linear-gradient(90deg, #e17055, #d63031);
        color: #fff;
    }

    .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        transition: all 0.3s;
    }

    .card-icon {
        font-size: 2rem;
        margin-bottom: 10px;
    }

    .card-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 5px;
        background: linear-gradient(90deg, #fff, #a8edea);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .card-label {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.9rem;
    }

    .controls {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }

    .btn-pause {
        background: linear-gradient(90deg, #e17055, #d63031);
        color: #fff;
    }

    .btn-resume {
        background: linear-gradient(90deg, #00b894, #00cec9);
        color: #fff;
    }

    .btn-refresh {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">æ¦‚è§ˆ</h1>
    <span id="status-badge" class="status-badge {{ 'status-paused' if is_paused else 'status-running' }}">
        {{ 'â¸ï¸ å·²æš‚åœ' if is_paused else 'âœ… è¿è¡Œä¸­' }}
    </span>
</div>

<div class="cards">
    <div class="card">
        <div class="card-icon">â±ï¸</div>
        <div class="card-value" id="uptime">{{ uptime }}</div>
        <div class="card-label">è¿è¡Œæ—¶é•¿</div>
    </div>
    <div class="card">
        <div class="card-icon">ğŸ’¬</div>
        <div class="card-value" id="today-replies">{{ today_replies }}</div>
        <div class="card-label">ä»Šæ—¥å›å¤</div>
    </div>
    <div class="card">
        <div class="card-icon">ğŸ”¢</div>
        <div class="card-value" id="today-tokens">{{ "{:,}".format(today_tokens) }}</div>
        <div class="card-label">ä»Šæ—¥ Token</div>
    </div>
    <div class="card">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-value" id="total-replies">{{ total_replies }}</div>
        <div class="card-label">æ€»å›å¤æ•°</div>
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 20px;">å¿«æ·æ§åˆ¶</h3>
    <div class="controls" style="margin: 0;">
        <button id="btn-pause" class="btn btn-pause" onclick="pauseBot()" {{ 'disabled' if is_paused else '' }}>
            â¸ï¸ æš‚åœæœºå™¨äºº
        </button>
        <button id="btn-resume" class="btn btn-resume" onclick="resumeBot()" {{ '' if is_paused else 'disabled' }}>
            â–¶ï¸ æ¢å¤è¿è¡Œ
        </button>
        <button class="btn btn-refresh" onclick="refreshStatus()">
            ğŸ”„ åˆ·æ–°çŠ¶æ€
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function pauseBot() {
        try {
            const resp = await fetch('/api/pause', { method: 'POST' });
            if (resp.ok) {
                refreshStatus();
            }
        } catch (e) {
            console.error('æš‚åœå¤±è´¥:', e);
        }
    }

    async function resumeBot() {
        try {
            const resp = await fetch('/api/resume', { method: 'POST' });
            if (resp.ok) {
                refreshStatus();
            }
        } catch (e) {
            console.error('æ¢å¤å¤±è´¥:', e);
        }
    }

    async function refreshStatus() {
        try {
            const resp = await fetch('/api/status');
            const data = await resp.json();

            document.getElementById('uptime').textContent = data.uptime;
            document.getElementById('today-replies').textContent = data.today_replies;
            document.getElementById('today-tokens').textContent = data.today_tokens.toLocaleString();
            document.getElementById('total-replies').textContent = data.total_replies;

            const badge = document.getElementById('status-badge');
            const btnPause = document.getElementById('btn-pause');
            const btnResume = document.getElementById('btn-resume');

            if (data.is_paused) {
                badge.className = 'status-badge status-paused';
                badge.textContent = 'â¸ï¸ å·²æš‚åœ';
                btnPause.disabled = true;
                btnResume.disabled = false;
            } else {
                badge.className = 'status-badge status-running';
                badge.textContent = 'âœ… è¿è¡Œä¸­';
                btnPause.disabled = false;
                btnResume.disabled = true;
            }
        } catch (e) {
            console.error('åˆ·æ–°å¤±è´¥:', e);
        }
    }

    // æ¯ 10 ç§’è‡ªåŠ¨åˆ·æ–°
    setInterval(refreshStatus, 10000);
</script>
{% endblock %}